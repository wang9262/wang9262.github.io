<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Vong"/><link rel="canonical" href="https://wang9262.github.io/posts/Eliminate-animation-hitches-with-XCTest"/><meta name="twitter:url" content="https://wang9262.github.io/posts/Eliminate-animation-hitches-with-XCTest"/><meta name="og:url" content="https://wang9262.github.io/posts/Eliminate-animation-hitches-with-XCTest"/><title>WWDC20 10077 - ä½¿ç”¨ XCTest æ¶ˆé™¤åŠ¨ç”»å¡é¡¿ | Vong</title><meta name="twitter:title" content="WWDC20 10077 - ä½¿ç”¨ XCTest æ¶ˆé™¤åŠ¨ç”»å¡é¡¿ | Vong"/><meta name="og:title" content="WWDC20 10077 - ä½¿ç”¨ XCTest æ¶ˆé™¤åŠ¨ç”»å¡é¡¿ | Vong"/><meta name="description" content="Vong,iOS,Performance,æ€§èƒ½,Swift,SwiftUI,Objective-C"/><meta name="twitter:description" content="Vong,iOS,Performance,æ€§èƒ½,Swift,SwiftUI,Objective-C"/><meta name="og:description" content="Vong,iOS,Performance,æ€§èƒ½,Swift,SwiftUI,Objective-C"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Vong"/><meta name="twitter:image" content="https://wang9262.github.io/media"/><meta name="og:image" content="https://wang9262.github.io/media"/></head><body class="item-page"><header><div class="wrapper"><div class="logo"><a href="/"><h2>Vong</h2></a></div><nav><ul><li><a href="/">é¦–é¡µ</a></li><li><a class="selected" href="/posts">æ–‡ç« </a></li><li><a href="/archive">å½’æ¡£</a></li><li><a href="/about">å…³äº</a></li><li><a href="/tags">æ ‡ç­¾</a></li></ul></nav></div></header><div class="wrapper"><div class="post-actions"><a href="https://twitter.com/intent/tweet?text=WWDC20 10077 - ä½¿ç”¨ XCTest æ¶ˆé™¤åŠ¨ç”»å¡é¡¿&url=https://wang9262.github.io/posts/Eliminate-animation-hitches-with-XCTest&via=Vong_HUST" target="_blank" rel="noreferrer"><img class="twitterIntent" src="/images/twitter.svg"/></a></div><article><div><h1>WWDC20 10077 - ä½¿ç”¨ XCTest æ¶ˆé™¤åŠ¨ç”»å¡é¡¿</h1></div><div><ul class="tag-list"><li class="tag tagdate">2020-06-20</li><li class="tag variant-3"><a href="/tags/wwdc">WWDC</a></li></ul><div class="content"><blockquote><p>æœ¬æ–‡åŸºäº <a href="https://developer.apple.com/videos/play/wwdc2020/10077/">Session 10077 - Eliminate animation hitches with XCTest</a></p></blockquote><h2>æ¦‚è¿°</h2><p>iOSä¸­åŠ¨ç”»æ— å¤„ä¸åœ¨ï¼Œåº”ç”¨ä¸­ä¼˜é›…æµç•…çš„åŠ¨ç”»å¯ä»¥æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒï¼ŒåŒç†å¡é¡¿ä¹Ÿä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚é€šè¿‡è¿™ä¸ª WWDC Sessionï¼Œæˆ‘ä»¬å°†å­¦ä¼šå¦‚ä½•é€šè¿‡ XCTest æ¥æ£€æµ‹æ»‘åŠ¨å’ŒåŠ¨ç”»è¿‡ç¨‹ä¸­çš„æ‰å¸§ï¼Œè¿›è€Œåœ¨å¼€å‘é˜¶æ®µå°±èƒ½è§£å†³é—®é¢˜ï¼Œé¿å…ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚</p><h2>å¦‚ä½•å®šä¹‰å¡é¡¿ï¼ˆHitchesï¼‰</h2><p>å½“ç”¨æˆ·åœ¨é¡µé¢ä¸Šæ“ä½œæ—¶ï¼Œæ¯”å¦‚ä¸Šä¸‹æ»‘æˆ–è€…ç‚¹å‡»å¯¼èˆªæ ä¸Šçš„è¿”å›æŒ‰é’®æ—¶ï¼Œä¸»è¦ç„¦ç‚¹é›†ä¸­åœ¨æ‰‹åŠ¿çš„äº¤äº’ä¸Šã€‚è‰¯å¥½çš„äº¤äº’ä½“éªŒæ˜¯æä¾›â€œä¼—äº«ä¸æ»‘â€çš„å“åº”é€Ÿåº¦ï¼Œåä¹‹ç”¨æˆ·å°†ä¼šæ„ŸçŸ¥åˆ°æ˜æ˜¾çš„å¡é¡¿ã€‚æˆ‘ä»¬å°†è¿™äº›ç”¨æˆ·å¯æ„ŸçŸ¥çš„â€œæŠ–åŠ¨â€ç§°ä¹‹ä¸ºå¡é¡¿ï¼ˆHitchesï¼‰ï¼Œå¡é¡¿æ˜¯æŒ‡æŸä¸€å¸§ç”»é¢çš„æ˜¾ç¤ºæ¯”é¢„æœŸè¦æ™šã€‚å¡é¡¿ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œç”šè‡³è®©ç”¨æˆ·å¤±å»å¯¹åº”ç”¨çš„å…´è¶£ï¼ˆå³å¸è½½ğŸ¶ï¼‰ã€‚</p><img src="https://images.xiaozhuanlan.com/photo/2020/77b300f2422ba1981ad8744443c129c8.png"/><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€å¸§æ¥çœ‹åŠ¨ç”»è¿‡ç¨‹ï¼Œå½“æˆ‘ä»¬ç¼“æ…¢ç§»åŠ¨æ—¶ï¼Œå‰2å¸§æŒ‰é¢„æœŸæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œæ»‘åŠ¨å¾ˆæµç•…ä¸”æ˜¯â€œè·Ÿæ‰‹â€çš„ï¼Œä½†æ˜¯ç¬¬3å¸§åœç•™åœ¨å±å¹•ä¸Šçš„æ—¶é—´è¶…å‡ºé¢„æœŸï¼Œæ»‘åŠ¨ä¸å†â€œè·Ÿæ‰‹â€ï¼Œç¬¬4å¸§å‡ºç°æ—¶ï¼Œåˆ—è¡¨å‡ºç°äº†ä¸€æ¬¡è·³å˜ï¼Œç„¶åæ»‘åŠ¨å†æ¬¡å˜å¾—â€œè·Ÿæ‰‹â€ã€‚</p><h3>æ¸²æŸ“åŸç†</h3><p>ä¸ºäº†ææ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šé¢çš„çŠ¶å†µï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹ç”»é¢æ˜¯å¦‚ä½•å±•ç¤ºåˆ°å±å¹•ä¸Šçš„ã€‚iPhone æˆ– iPad ä¸Šçš„å¸§ç‡ä¸€èˆ¬éƒ½æ˜¯60ï¼Œå³åˆ·æ–°é¢‘ç‡ä¸º60èµ«å…¹ï¼Œæ¯å¸§è€—æ—¶16.67æ¯«ç§’ï¼Œä½†æ˜¯åœ¨ iPad Pro çš„åˆ·æ–°é¢‘ç‡ä¸º120èµ«å…¹ï¼Œå³æ¯å¸§è€—æ—¶8.33æ¯«ç§’ã€‚å‚ç›´åŒæ­¥ä¿¡å·å†³å®šäº†æ˜¯å¦éœ€è¦åˆ‡æ¢å½“å‰æ˜¾ç¤ºçš„å¸§ï¼Œå½“æŸä¸€å³å°†è¦æ˜¾ç¤ºçš„è§†é¢‘å¸§åœ¨å‚ç›´åŒæ­¥ä¿¡å·æ¥ä¸´çš„æ—¶å€™æ²¡æœ‰æ˜¾ç¤ºï¼Œå°±å‘ç”Ÿäº†å¡é¡¿ï¼Œå¡é¡¿çš„ä¸¥é‡ç¨‹åº¦å–å†³äºé‚£ä¸€å¸§å»¶è¿Ÿäº†å¤šä¹…æ‰å±•ç¤ºï¼Œæ‹¿ä¸Šå›¾ä¸ºä¾‹ï¼Œç¬¬4å¸§å»¶è¿Ÿäº†16.67æ¯«ç§’æ‰å±•ç¤ºåˆ°å±å¹•ä¸Šã€‚</p><blockquote><p>æ›´å¤šä»‹ç»æ¨èå‚çœ‹ <a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/#2">ã€ŠiOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§ã€‹</a>ã€‚</p></blockquote><h3>é‡åŒ–å¡é¡¿</h3><p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é‡åŒ–å¡é¡¿ï¼š</p><ul><li>æ´»åŠ¨.å¡é¡¿æ—¶é—´ï¼šæŸä¸€å¸§æ¯”é¢„æœŸå±•ç¤ºçš„æ—¶é—´æ™šäº†å¤šå°‘æ¯«ç§’</li><li>2.å¡é¡¿ç‡ï¼šæ€»çš„å¡é¡¿æ—¶é—´/æ€»æ—¶é—´</li></ul><p>å¬èµ·æ¥å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥ç”¨æ‰å¸§æˆ–è€…æ‰å¸§ç‡æ¥è¡¨è¿°å‘¢ï¼Ÿå› ä¸ºå¸§ç‡å¤ªç»å¯¹ï¼Œå®¹æ˜“é€ æˆè¯¯è§£ã€‚å¦‚æœæµ‹è¯•è¿‡ç¨‹é™¤äº†åŠ¨ç”»å¤–è¿˜æœ‰å…¶ä»–ï¼ˆé—²ç½®ï¼‰é˜¶æ®µï¼Œé‚£ä¹ˆ FPS çš„æ„ä¹‰å°±æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œå› ä¸ºé—²ç½®æœŸé—´æˆ‘ä»¬æœ¬èº«å°±ä¸å¸Œæœ›ç”»é¢ä¼šå˜æ¢ï¼ŒåŒæ—¶ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè®¾ç½®ä¸€äº›ä½äºæœ€å¤§ FPS çš„å¸§ç‡ï¼Œæ¯”å¦‚ä¸€äº›æ¸¸æˆçš„å¸§ç‡æ˜¯æ¯ç§’30å¸§ï¼Œè§†é¢‘çš„å¸§ç‡æ˜¯æ¯ç§’24å¸§ã€‚æ‹¿iOSç³»ç»Ÿçš„<strong>æ—¶é’Ÿåº”ç”¨</strong>ä¸ºä¾‹ï¼Œè€ƒè™‘åˆ°æ€§èƒ½åŠç”µæ± æŸè€—ï¼Œicon ä¸Šçš„æŒ‡é’ˆçš„å¸§ç‡ä¸º10ã€‚</p><p>å¡é¡¿æ—¶é—´é€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸å¯æ¯”è¾ƒçš„ï¼Œæ´»åŠ¨ç§’å†…æ€»çš„å¡é¡¿æ—¶é—´å’Œ10ç§’å†…çš„æ€»çš„å¡é¡¿æ—¶é—´æ˜¯æ²¡æœ‰å¯æ¯”æ€§çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»Ÿä¸€å¡é¡¿ç‡ï¼ˆå³æµ‹è¯•é˜¶æ®µæ¯ç§’çš„å¡é¡¿æ—¶é—´ï¼‰æ¥åˆ¶å®šä¸€äº›åº¦é‡æ ‡å‡†æ¥å¯¹æ¯”ä¸åŒæµ‹è¯•çš„åœºæ™¯ï¼Œç„¶åå¾—å‡ºå¤§æ¦‚çš„ç”¨æˆ·å½±å“æƒ…å†µã€‚</p><h3>æ ‡å‡†æ¨è</h3><p>è‹¹æœæ¨èä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå€¼æ¥å®šä¹‰å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“ç¨‹åº¦ï¼š</p><img src="https://images.xiaozhuanlan.com/photo/2020/3df986eff6c07ea23f7268f91fbf1941.png"/><table><thead><tr><th>ç¨‹åº¦</th><th>æ ‡å‡†å€¼</th></tr></thead><tbody><tr><td>ä¸¥é‡</td><td>æ¯ç§’é’Ÿå¡é¡¿è¶…è¿‡10æ¯«ç§’ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒéœ€è¦ç«‹å³è§£å†³</td></tr><tr><td>è­¦å‘Š</td><td>æ¯ç§’é’Ÿå¡é¡¿åœ¨5ï½10æ¯«ç§’ä¹‹é—´ï¼Œç”¨æˆ·å¯èƒ½ä¼šå¯Ÿè§‰ï¼Œéœ€è¦å¼€å§‹ä»‹å…¥æ’æŸ¥</td></tr><tr><td>è‰¯å¥½</td><td>æ¯ç§’é’Ÿå¡é¡¿å°äº5æ¯«ç§’ï¼Œç»§ç»­ä¿æŒ</td></tr></tbody></table><h3>åº¦é‡åŠä¼˜åŒ–</h3><p>ä» iOS14 å¼€å§‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å¼€å‘åŠçº¿ä¸Šé˜¶æ®µå‡å¯ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ XCTest æ¡†æ¶æ¥æ’æŸ¥åŠ¨ç”»çš„å¡é¡¿ã€‚åœ¨å•å…ƒæµ‹è¯•å’Œ UI æµ‹è¯•ä¸­å¯ä»¥ä½¿ç”¨ XCTest æ¥æ”¶é›†åŠ¨ç”»ç›¸å…³æ•°æ®åŠå¡é¡¿ä¿¡æ¯ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨ MetricKit æ”¶é›†çº¿ä¸Šç”¨æˆ·å¡é¡¿æ•°æ®ï¼Œç„¶åç»“åˆ Xcode Organizer æ¥åšæ€§èƒ½åˆ†æã€‚</p><img src="https://images.xiaozhuanlan.com/photo/2020/3f69a444c18b13635b461bad946df431.png"/><p>è¿™ä¸ª Session ä¸»è¦å…³æ³¨å¼€å‘é˜¶æ®µå¦‚ä½•ä½¿ç”¨ XCTest æ€§èƒ½æµ‹è¯•æ¥æ•è·å¡é¡¿ï¼Œæƒ³è¦äº†è§£å¦‚ä½•æŸ¥çœ‹çº¿ä¸Šç”¨æˆ·çš„å¡é¡¿ä¿¡æ¯å¯ä»¥ç¿»çœ‹å¦å¤–ä¸¤ä¸ª Sessionã€‚</p><img src="https://images.xiaozhuanlan.com/photo/2020/b41ce88a28ad7bd01a82a5e514f364d1.png"/><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2020/10081/">WWDC20 10081-What's New in MetricKit</a> <a href="https://developer.apple.com/videos/play/wwdc2020/10076/">WWDC20 10076-Diagnose Performance Issues with the Xcode Origanizer</a></p></blockquote><p>åœ¨ Xcode 11 ä¸­è‹¹æœå¼•å…¥äº† XCTMetrics æ¥å¸®åŠ©å¼€å‘è€…è¡¡é‡ä¸€äº›ç³»ç»Ÿæ€§èƒ½æ•°æ®ï¼Œæ¯”å¦‚è€—æ—¶ã€CPU ä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ã€os_signpost æ‰“ç‚¹ä»¥åŠå­˜å‚¨ã€‚</p><img src="https://images.xiaozhuanlan.com/photo/2020/9858c7ddda13cd191accd530c30258aa.png"/><p>Xcode 12 å¼•å…¥äº†ä¸€é¡¹ç‹¬ç«‹çš„å¯åŠ¨è€—æ—¶çš„è¡¡é‡æ ‡å‡† <code>XCTApplicationLaunchMetric</code>ï¼ŒåŒæ—¶ä¹Ÿæ–°å¢äº†ä¸€äº›æ¨¡æ¿ä¾›å¼€å‘è€…æ¥åˆ¶å®šè‡ªå·±çš„æ€§èƒ½è¡¡é‡æ ‡å‡†ã€‚</p><details>
<summary>ğŸ‘‰ç‚¹å‡»æŸ¥çœ‹æ–°å¢API</summary>
```objc
@interface XCTOSSignpostMetric (XCTBuiltinOSSignposts)

/*!
 * @property navigationTransitionMetric
 * The XCTMetric object covering navigation transitions between views
 */
@property (readonly, class) id<XCTMetric> navigationTransitionMetric API_AVAILABLE(ios(14.0), tvos(14.0)) API_UNAVAILABLE(macos);

/*!
 * @property customNavigationTransitionMetric
 * The XCTMetric object covering custom navigation transitions between views
 */
@property (readonly, class) id<XCTMetric> customNavigationTransitionMetric API_AVAILABLE(ios(14.0), tvos(14.0)) API_UNAVAILABLE(macos);

/*!
 * @property scrollDecelerationMetric
 * The XCTMetric object covering scroll deceleration animations
 */
@property (readonly, class) id<XCTMetric> scrollDecelerationMetric API_AVAILABLE(ios(14.0), tvos(14.0)) API_UNAVAILABLE(macos);

/*!
 * @property scrollDraggingMetric
 * The XCTMetric object covering scroll dragging animations
 */
@property (readonly, class) id<XCTMetric> scrollDraggingMetric API_AVAILABLE(ios(14.0), tvos(14.0)) API_UNAVAILABLE(macos);

@end

/*!
 * @class XCTApplicationLaunchMetric
 * A metric which measures application launch durations.
*/
API_AVAILABLE(macos(10.15), ios(13.0), tvos(13.0))
__attribute__((objc_subclassing_restricted))
@interface XCTApplicationLaunchMetric : NSObject <XCTMetric>

/*!
 * @method -init
 * Initializes an application launch metric that measures the duration an application takes to display its first frame to screen.
 */
- (instancetype)init;

/*!
 * @method -initWithWaitUntilResponsive
 * Initializes an application launch metric that measures the duration an application takes to display its first frame to screen.
 *
 * @param waitUntilResponsive Specifies the end of the application launch interval to be when the application has displayed the first frame and is responsive.
*/
- (instancetype)initWithWaitUntilResponsive:(BOOL)waitUntilResponsive API_AVAILABLE(macos(10.16), ios(14.0), tvos(14.0));

@end

```
</details><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ <code>XCTOSSignpostMetric</code>ï¼›ä» Xcode 11 å¼€å§‹ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ <code>XCTOSSignpostMetric</code> æ¥è®¡ç®— <code>os_signpost</code> çš„æ—¶é—´é—´éš”ã€‚åœ¨ Xcode 12 ä¸­ï¼Œå½“ä½¿ç”¨ <code>os_signpost</code> æ¥è®¡ç®—åŠ¨ç”»æ—¶é—´é—´éš”æ—¶ï¼Œé™¤äº†å¯ä»¥è·å–åˆ°æ—¶é—´é—´éš”å¤–ï¼Œè¿˜èƒ½é¢å¤–å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªæ•°å€¼ï¼šå¡é¡¿æ¬¡æ•°ã€å¡é¡¿æ€»æ—¶é•¿ã€å¡é¡¿æ—¶é—´å æ¯”ã€å¸§ç‡ã€å¸§æ•°ï¼ˆå…¶ä¸­å‰ä¸‰é¡¹ä¸º iOS ç‰¹æœ‰ï¼‰ã€‚</p><img src="https://images.xiaozhuanlan.com/photo/2020/80f2b8278d95b7b8dea60a3cef810091.png"/><img src="https://images.xiaozhuanlan.com/photo/2020/2a0a88346f13b76919d8906b59c8d85e.png"/><p>æƒ³è¦è·å–è¿™äº›æ•°æ®ï¼Œéœ€è¦åœ¨ä»£ç ä¸­é›†æˆ <code>os_signpost</code> åŸ‹ç‚¹ï¼Œæœ‰3ç§é›†æˆåœºæ™¯</p><ul><li>è®¡ç®—æ— åŠ¨ç”»æ—¶é—´é—´éš”</li><li>ä½¿ç”¨ <code>.animationBegin</code> çš„æ–¹å¼è®¡ç®—åŠ¨ç”»æ—¶é—´é—´éš”</li><li>UIKitæœ¬èº«çš„è®¡ç®—æ–¹å¼</li></ul><blockquote><p>ç¬¬ä¸€ç§åªè¿”å›æ—¶é—´é—´éš”ï¼Œç¬¬äºŒç§é™¤äº†æ—¶é—´é—´éš”ä»¥å¤–ï¼Œè¿˜ä¼šè¿”å›ä¸Šé¢æåˆ°çš„å‡ ä¸ªå€¼ã€‚</p></blockquote><img src="https://images.xiaozhuanlan.com/photo/2020/32b02aa2994f8b730dced0dfe177536a.png"/><p>åœ¨ Xcode 11 ä¸­ï¼Œæˆ‘ä»¬åªèƒ½è°ƒç”¨ <code>os_signpost</code> é‡Œçš„ <code>.begin</code> å’Œ <code>.end</code> æ¥æµ‹é‡ä¸€äº›éåŠ¨ç”»çš„æ—¶é—´é—´éš”ã€‚åœ¨ Xcode 12 ä¸­ï¼Œå¯ä»¥æŒ‡å®šè®¡ç®—åŠ¨ç”»æ—¶é—´é—´éš”çš„æ–¹å¼ï¼Œä»…éœ€å°†ä¹‹å‰çš„ <code>.begin</code> æ¥å£æ›¿æ¢ä¸º <code>.animationBegin</code>ã€‚</p><pre data-language="swift"><code>os_signpost(.animationBegin, log: logHandle, name: <span class="hljs-string">"performAnimationInterval"</span>)
os_signpost(.end, log: logHandle, name: <span class="hljs-string">"performAnimationInterval"</span>)
</code></pre><p>é™¤äº†ä½¿ç”¨è‡ªå®šä¹‰çš„æ—¶é—´é—´éš”ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç³»ç»Ÿé¢„ç½®çš„å‡ ä¸ª <code>UIKit</code> ç›¸å…³çš„ <code>metric</code> æ¥æµ‹é‡å¯¼èˆªåŠ¨ç”»è½¬åœºä»¥åŠæ»‘åŠ¨çš„åœºæ™¯ã€‚</p><p>ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™å‡ ä¸ªé¢„ç½®çš„ <code>metric</code> çš„ä¾‹å­ã€‚</p><pre data-language="swift"><code><span class="hljs-comment">// Measure scrolling animation performance using a Performance XCTest</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testScrollingAnimationPerformance</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">throws</span> {
    app.launch()
    app.staticTexts[<span class="hljs-string">"Meal Planner"</span>].tap()
    <span class="hljs-keyword">let</span> foodCollection = app.collectionViews.firstMatch
    
    measure(metrics: [<span class="hljs-type">XCTOSSignpostMetric</span>.scrollDecelerationMetric]) {
        foodCollection.swipeUp(velocity: .fast)
    }
}
</code></pre><p>å¯åŠ¨åº”ç”¨åï¼Œç‚¹å‡» <code>Meal Planner</code> è¿›å…¥æ–‡ç« æœ€å¼€å§‹çš„é‚£ä¸ªåˆ—è¡¨é¡µï¼Œç„¶åå°†å‘ä¸Šå¿«é€Ÿæ»‘åŠ¨çš„ä»£ç å—æ”¾åˆ° <code>measure block</code> é‡Œï¼ŒåŒæ—¶æŒ‡å®š <code>metric</code> ä¸º <code>scrollDecelerationMetric</code>ã€‚</p><blockquote><p>Xcode 12èµ·ï¼Œ<code>swipe</code> å¯ä»¥æŒ‡å®šæ»‘åŠ¨é€Ÿåº¦ã€‚</p></blockquote><p><code>measure block</code> é‡Œé¢çš„ä»£ç é»˜è®¤æƒ…å†µä¸‹ä¼šæ‰§è¡Œ5æ¬¡æ¥æœé›†æ€§èƒ½æ•°æ®ï¼Œè¿™å°±æ„å‘³ç€ä¼šè¿ç»­å‘ä¸Šæ»‘åŠ¨åˆ—è¡¨5æ¬¡ï¼Œå³æ¯ä¸€æ¬¡æ»‘åŠ¨å±•ç¤ºçš„æ˜¯ä¸åŒå†…å®¹ï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬å¸Œæœ›5æ¬¡æ»‘åŠ¨æ‰€å¤„çš„åœºæ™¯æ˜¯ä¸€è‡´çš„ã€‚å¯ä»¥é€šè¿‡å¯¹ä¸Šé¢ä»£ç åšå¦‚ä¸‹ä¸¤å¤„æ”¹é€ </p><pre data-language="Swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testScrollingAnimationPerformance</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">throws</span> { 
    app.launch()
    app.staticTexts[<span class="hljs-string">"Meal Planner"</span>].tap()
    <span class="hljs-keyword">let</span> foodCollection = app.collectionViews.firstMatch

    <span class="hljs-comment">// æ´»åŠ¨</span>
    <span class="hljs-keyword">let</span> measureOptions = <span class="hljs-type">XCTMeasureOptions</span>()
    measureOptions.invocationOptions = [.manuallyStop]
        
    measure(metrics: [<span class="hljs-type">XCTOSSignpostMetric</span>.scrollDecelerationMetric],
            options: measureOptions) {
        foodCollection.swipeUp(velocity: .fast)
        <span class="hljs-comment">// 2</span>
        stopMeasuring()
        foodCollection.swipeDown(velocity: .fast)
    }
}
</code></pre><p>æ´»åŠ¨. åˆ›å»º <code>measureOptions</code>ï¼ŒæŒ‡å®šä¸ºæ‰‹åŠ¨åœæ­¢ 2. åœ¨ <code>measure block</code> ä¸­è°ƒç”¨ <code>stopMeasuring</code> æ–¹æ³•ï¼Œç„¶åå¾€ä¸‹å¿«é€Ÿæ»‘åŠ¨é‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚</p><p>æµ‹è¯•ç”¨ä¾‹å‡†å¤‡å°±ç»ªï¼Œä¸ºäº†æ¶ˆé™¤å¤–éƒ¨å½±å“ï¼Œè¿˜éœ€è¦åšä¸€äº›é¢å¤–è®¾ç½®</p><ul><li>ä¸ºæ€§èƒ½æµ‹è¯•å»ºä¸€ä¸ªç‹¬ç«‹çš„ <code>scheme</code>ï¼Œç„¶åä½¿ç”¨ <code>release</code> æ¨¡å¼ï¼ŒåŒæ—¶ç¦ç”¨æ‰è°ƒè¯•å™¨ã€‚ <img src="https://images.xiaozhuanlan.com/photo/2020/df070ebb38e673579f6d5a62c2e01a09.png"/></li><li>ç¦ç”¨æ‰è‡ªåŠ¨æˆªå±åŠè¦†ç›–ç‡ <img src="https://images.xiaozhuanlan.com/photo/2020/80eac3de06887c790ec30370d887d4c3.png"/></li><li>ç¦ç”¨ä¸€äº›è¿è¡Œæ—¶æ£€æµ‹åŠŸèƒ½ <img src="https://images.xiaozhuanlan.com/photo/2020/724f6bf99816106bf12afe4c102ac046.png"/></li></ul><p>åšå®Œä¸Šè¿°æ“ä½œï¼Œå³å¯è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åæŸ¥çœ‹å¯¹åº”ç»“æœã€‚åœ¨ç»“æœé¡µé¢é€‰ä¸­ <code>Hitch Time Ratio</code>ï¼Œå¯ä»¥çœ‹åˆ°5æ¬¡è¿è¡Œè®°å½•çš„ç»“æœï¼Œé¡µé¢ä¸Šä¹Ÿä¼šè®¡ç®—å‡ºå¹³å‡å€¼ï¼ˆæ¯ç§’å¡é¡¿1.2æ¯«ç§’ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®è¿™ä¸ªå€¼ä½œä¸ºåŸºå‡†å€¼ï¼Œåç»­è¿™ä¸ªç”¨ä¾‹çš„ç»“æœéƒ½ä¼šå’ŒåŸºå‡†å€¼å¯¹æ¯”ï¼Œç¡®ä¿å¡é¡¿ç»´æŒåœ¨åˆç†èŒƒå›´ï¼Œé¿å…å°†ä¸¥é‡å¡é¡¿å‘å¸ƒåˆ°çº¿ä¸Šï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p><img src="https://images.xiaozhuanlan.com/photo/2020/209f4d90ff96ed3280e3313b4cd7dafc.png"/><p>æœ€åï¼Œæ¼”è®²è€…é€šè¿‡ä¸€ä¸ªç®€å•çš„ <code>Demo</code> æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>XCTest</code> æ¥ä¼˜åŒ–åŠ¨ç”»ä¸­çš„å¡é¡¿ï¼Œå…·ä½“ç¤ºä¾‹æ˜¯åœ¨ <code>cellForItem</code> é‡Œæ–¹æ³•é‡Œå°†å›¾ç‰‡é‡ç»˜æ”¹æˆè®¾ç½®è§†å›¾çš„ <code>contentMode</code>ï¼Œä»¥æ­¤å‡å°‘ä¸»çº¿ç¨‹å¡é¡¿å’Œ CPU å ç”¨ã€‚</p><h2>æœ€å</h2><p>é€šè¿‡ä»¥ä¸Šçš„æ¼”ç¤ºå’Œæ–° API è®²è§£ï¼Œç›¸ä¿¡å¤§å®¶å¯¹äºå¡é¡¿çš„æ£€æµ‹å’Œä¼˜åŒ–æœ‰äº†ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£ï¼Œæ¥ä¸‹æ¥å°±æ˜¯äº²æ‰‹å®è·µäº†ã€‚Have Funï½</p></div></div></article><div class="item-navigator"><table><tr><td class="previous-item"><a href="/posts/An-Abnormal-Swift-Crash">èŠèŠæœ€è¿‘é‡åˆ°çš„ä¸€ä¸ªCrash</a></td><td class="next-item"><a href="/posts/Attention-to-Category">ä¸€ä¸ªä¸è§„èŒƒçš„ Category å†™æ³•å¯¼è‡´çš„â€œè¡€æ¡ˆâ€</a></td></tr></table></div><div id="gitalk-container"></div>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
var gitalk = new Gitalk({
clientID: 'b56f11f2c9cf1bbc87ac',
clientSecret: '25bb2ed5e176e5136e883d24ed6d78543378c247',
repo: 'Blog-Comments',
owner: 'wang9262',
admin: ['wang9262'],
id: 'WWDC20 10077 - ä½¿ç”¨ XCTest æ¶ˆé™¤åŠ¨ç”»å¡é¡¿',      // Ensure uniqueness and length less than 50
distractionFreeMode: true,  // Facebook-like distraction free mode
createIssueManually: true,
language: navigator.userLanguage
});

gitalk.render('gitalk-container');

</script><footer><p>Copyright &copy;Vong 2021 </p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><ul class="icon"><li><a href="https://twitter.com/fatbobman"><img class="twitter" src="/images/twitter.svg"/></a></li><li><a href="https://github.com/fatbobman/"><img src="/images/github.svg"/></a></li><li><a href="https://www.zhihu.com/people/fatbobman3000"><img src="/images/zhihu.svg"/></a></li><li><a href="/feed.rss"><img src="/images/rss.svg"/></a></li></ul><script>
    // dynamic User by Hux
    var _gaId = 'UA-56148425-1';
    var _gaDomain = 'wang9262.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>

<!-- Baidu Tongji -->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8aa6c37a6671fca3a595bb5c714cafc7";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
</footer></div></body></html>